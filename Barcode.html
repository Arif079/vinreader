<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barcode Reader & Generator</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* Modern Web Design Standards */
    :root {
      --color-primary: #0891b2;
      --color-background: #121212;
      --color-surface: #1e1e1e;
      --color-on-surface: #e0e0e0;
      --color-accent: #06b6d4;
      --border-radius: 12px;
      --spacing-sm: 12px;
      --spacing-md: 24px;
      --spacing-lg: 48px;
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --color-background: #f9fafb;
        --color-surface: #ffffff;
        --color-on-surface: #1f2937;
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background-color: var(--color-background);
      color: var(--color-on-surface);
      font-family: var(--font-family);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--color-surface);
      padding: var(--spacing-md);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255 255 255 / 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-accent);
      user-select: none;
    }

    main {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-lg);
      padding: var(--spacing-lg);
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
        padding: var(--spacing-md);
        gap: var(--spacing-md);
      }
    }

    section {
      background: var(--color-surface);
      border-radius: var(--border-radius);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      padding: var(--spacing-lg);
      display: flex;
      flex-direction: column;
      min-height: 400px;
    }

    section h2 {
      margin-top: 0;
      margin-bottom: var(--spacing-md);
      font-weight: 700;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.75rem;
    }

    button {
      cursor: pointer;
      background-color: var(--color-primary);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      user-select: none;
    }

    button:hover:not(:disabled) {
      background-color: var(--color-accent);
    }

    button:disabled {
      background-color: rgba(8, 145, 178, 0.5);
      cursor: not-allowed;
    }

    input[type="text"],
    select {
      font-size: 1rem;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      width: 100%;
      max-width: 100%;
      margin-bottom: var(--spacing-md);
      color: var(--color-on-surface);
      background-color: #fff;
      font-family: var(--font-family);
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: var(--color-primary);
      outline: none;
    }

    label {
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
      color: var(--color-primary);
    }

    #generator svg {
      max-width: 100%;
      height: auto !important;
      margin-top: var(--spacing-md);
      border: 1px solid #888;
      border-radius: 8px;
      background: white;
      padding: 12px;
    }

    /* Barcode Reader Styles */
    #reader-container {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    #video-container {
      position: relative;
      border-radius: var(--border-radius);
      overflow: hidden;
      border: 1px solid #888;
      background: black;
      width: 100%;
      height: 300px;
      margin-bottom: var(--spacing-md);
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    #scan-result {
      font-weight: 700;
      font-size: 1.2rem;
      min-height: 44px;
      padding: 8px;
      background: rgba(6, 182, 212, 0.12);
      border-radius: 8px;
      color: var(--color-primary);
      user-select: text;
      word-break: break-all;
    }

    #upload-label {
      display: inline-block;
      margin-top: var(--spacing-md);
      font-weight: 600;
      color: var(--color-primary);
      cursor: pointer;
      user-select: none;
    }

    #barcode-file-input {
      display: none;
    }

    .material-icons {
      font-size: 1.5rem;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <header>
    <span class="material-icons" aria-hidden="true">qr_code_scanner</span>&nbsp;Barcode Reader & Generator
  </header>
  <main>
    <section id="generator" aria-label="Barcode Generator">
      <h2><span class="material-icons" aria-hidden="true">qr_code</span> Generate Barcode</h2>
      <form id="barcode-form" onsubmit="return false">
        <label for="barcode-text">Text to encode</label>
        <input id="barcode-text" type="text" autocomplete="off" placeholder="Enter text or numbers" required aria-required="true" />
        <label for="barcode-type">Barcode Type</label>
        <select id="barcode-type" aria-label="Barcode type selector">
          <option value="CODE128" selected>Code 128</option>
          <option value="EAN13">EAN-13</option>
          <option value="EAN8">EAN-8</option>
          <option value="UPC">UPC</option>
          <option value="CODE39">Code 39</option>
          <option value="ITF14">ITF-14</option>
          <option value="MSI">MSI</option>
          <option value="Pharmacode">Pharmacode</option>
        </select>
        <button id="generate-btn" type="submit" aria-label="Generate Barcode Button">
          <span class="material-icons" aria-hidden="true">play_arrow</span> Generate
        </button>
        <button id="clear-btn" type="button" aria-label="Clear Barcode Button" style="margin-left: 12px; background-color: #bb1f1f;">
          <span class="material-icons" aria-hidden="true">clear</span> Clear
        </button>
      </form>
      <div id="barcode-output" aria-live="polite" aria-atomic="true" style="margin-top: 24px;"></div>
    </section>

    <section id="reader" aria-label="Barcode Reader">
      <h2><span class="material-icons" aria-hidden="true">camera_alt</span> Scan Barcode</h2>
      <div id="reader-container">
        <div id="video-container" aria-live="polite" aria-atomic="true">
          <div id="video-placeholder" style="color: #888; display: flex; justify-content: center; align-items: center; height: 100%;">
            Camera video will appear here
          </div>
          <video id="scanner-video" autoplay muted playsinline></video>
        </div>
        <button id="start-scan-btn" aria-label="Start scanning barcode" type="button" style="margin-top: 8px;">
          <span class="material-icons" aria-hidden="true">videocam</span> Start Scanner
        </button>
        <button id="stop-scan-btn" aria-label="Stop scanning barcode" type="button" style="margin-top: 8px; display:none; background-color: #bb1f1f;">
          <span class="material-icons" aria-hidden="true">stop</span> Stop Scanner
        </button>

        <label for="barcode-file-input" id="upload-label" tabindex="0" role="button" aria-label="Upload barcode image to scan">
          <span class="material-icons" aria-hidden="true">upload_file</span> Upload Image to Scan
        </label>
        <input type="file" id="barcode-file-input" accept="image/*" aria-describedby="upload-label" />

        <div id="scan-result" aria-live="polite" aria-atomic="true" role="region" aria-label="Barcode scan result"></div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
  <script>
    // Barcode Generator
    const barcodeForm = document.getElementById('barcode-form');
    const barcodeTextInput = document.getElementById('barcode-text');
    const barcodeTypeSelect = document.getElementById('barcode-type');
    const barcodeOutput = document.getElementById('barcode-output');
    const generateBtn = document.getElementById('generate-btn');
    const clearBtn = document.getElementById('clear-btn');

    let svgElement;

    function generateBarcode() {
      const text = barcodeTextInput.value.trim();
      const type = barcodeTypeSelect.value;

      if (!text) {
        barcodeOutput.innerHTML = '';
        return;
      }

      barcodeOutput.innerHTML = '';
      svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svgElement.setAttribute('aria-label', 'Generated barcode');
      svgElement.setAttribute('role', 'img');
      svgElement.style.maxWidth = '100%';
      svgElement.style.height = 'auto';

      barcodeOutput.appendChild(svgElement);

      try {
        JsBarcode(svgElement, text, {
          format: type,
          lineColor: "#000",
          width: 2,
          height: 100,
          displayValue: true,
          fontOptions: "bold",
          margin: 10
        });
      } catch (err) {
        barcodeOutput.innerHTML = '<p style="color: #bb1f1f; font-weight: 700;">Error generating barcode: ' + err.message + '</p>';
      }
    }

    generateBtn.addEventListener('click', generateBarcode);

    clearBtn.addEventListener('click', () => {
      barcodeTextInput.value = '';
      barcodeOutput.innerHTML = '';
      barcodeTextInput.focus();
    });

    // Barcode Reader with QuaggaJS
    const video = document.getElementById('scanner-video');
    const videoContainer = document.getElementById('video-container');
    const startScanBtn = document.getElementById('start-scan-btn');
    const stopScanBtn = document.getElementById('stop-scan-btn');
    const scanResult = document.getElementById('scan-result');
    const videoPlaceholder = document.getElementById('video-placeholder');
    const barcodeFileInput = document.getElementById('barcode-file-input');

    let scanning = false;

    function startScanner() {
      if (scanning) return;

      scanResult.textContent = '';
      videoPlaceholder.style.display = 'none';
      video.style.display = 'block';

      Quagga.init(
        {
          inputStream: {
            name: "Live",
            type: "LiveStream",
            target: videoContainer,
            constraints: {
              facingMode: "environment",
              width: { min: 640 },
              height: { min: 480 },
            },
          },
          decoder: {
            readers: [
              "code_128_reader",
              "ean_reader",
              "ean_8_reader",
              "code_39_reader",
              "code_39_vin_reader",
              "codabar_reader",
              "upc_reader",
              "upc_e_reader",
              "i2of5_reader",
              "2of5_reader",
              "code_93_reader",
            ],
          },
          locate: true,
          numOfWorkers: navigator.hardwareConcurrency || 4,
          frequency: 10,
          singleChannel: false,
          multiple: false,
        },
        function (err) {
          if (err) {
            scanResult.textContent = "Error starting scanner: " + err.message;
            videoPlaceholder.style.display = 'flex';
            video.style.display = 'none';
            return;
          }
          Quagga.start();
          scanning = true;
          startScanBtn.style.display = 'none';
          stopScanBtn.style.display = 'inline-flex';
        }
      );

      Quagga.onDetected(onDetectedHandler);
    }

    function stopScanner() {
      if (!scanning) return;
      Quagga.stop();
      Quagga.offDetected(onDetectedHandler);
      scanning = false;
      startScanBtn.style.display = 'inline-flex';
      stopScanBtn.style.display = 'none';
      videoPlaceholder.style.display = 'flex';
      video.style.display = 'none';
    }

    function onDetectedHandler(result) {
      if (result && result.codeResult && result.codeResult.code) {
        scanResult.textContent = 'Detected code: ' + result.codeResult.code;
        // Optionally stop after first detection
        stopScanner();
      }
    }

    startScanBtn.addEventListener('click', () => {
      startScanner();
    });

    stopScanBtn.addEventListener('click', () => {
      stopScanner();
    });

    // Scan from image upload
    barcodeFileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      scanResult.textContent = '';
      if (!file) return;

      const img = document.createElement('img');
      img.onload = function() {
        Quagga.decodeSingle(
          {
            src: img.src,
            numOfWorkers: 0,
            inputStream: {
              size: 800,
            },
            decoder: {
              readers: [
                "code_128_reader",
                "ean_reader",
                "ean_8_reader",
                "code_39_reader",
                "code_39_vin_reader",
                "codabar_reader",
                "upc_reader",
                "upc_e_reader",
                "i2of5_reader",
                "2of5_reader",
                "code_93_reader",
              ],
            }
          },
          function(result) {
            if (result && result.codeResult) {
              scanResult.textContent = 'Detected code from image: ' + result.codeResult.code;
            } else {
              scanResult.textContent = 'No barcode detected in image.';
            }
          }
        );
      };
      img.onerror = () => {
        scanResult.textContent = 'Failed to load image for scanning.';
      };

      const reader = new FileReader();
      reader.onload = function(e) {
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });

  </script>
</body>
</html>

